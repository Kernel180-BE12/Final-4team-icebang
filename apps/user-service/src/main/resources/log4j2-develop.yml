Configuration:
  name: develop

  properties:
    property:
      - name: "log-path"
        value: "./logs"
      - name: "charset-UTF-8"
        value: "UTF-8"
      # 통일된 콘솔 패턴 - 모든 로그에 RequestId 포함
      - name: "console-layout-pattern"
        value: "%highlight{[%-5level]} [%X{traceId}] %d{MM-dd HH:mm:ss} [%t]  %n %msg%n%n"
      # 파일용 상세 패턴 - RequestId 포함
      - name: "file-layout-pattern"
        value: "[%X{traceId}] %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"
      # 로그 파일 경로들
      - name: "info-log"
        value: ${log-path}/user-service/info.log
      - name: "error-log"
        value: ${log-path}/user-service/error.log
      - name: "auth-log"
        value: ${log-path}/user-service/auth.log
      - name: "json-log"
        value: ${log-path}/user-service/json-info.log

  # [Appenders] 로그 기록방식 정의
  Appenders:
    # 통일된 콘솔 출력
    Console:
      name: console-appender
      target: SYSTEM_OUT
      PatternLayout:
        pattern: ${console-layout-pattern}

    # 롤링 파일 로그
    RollingFile:
      name: rolling-file-appender
      fileName: ${log-path}/rolling-file.log
      filePattern: "logs/archive/rolling-file.log.%d{yyyy-MM-dd-hh-mm}_%i.gz"
      PatternLayout:
        charset: ${charset-UTF-8}
        pattern: ${file-layout-pattern}
      Policies:
        SizeBasedTriggeringPolicy:
          size: "200KB"
        TimeBasedTriggeringPolicy:
          interval: "1"
      DefaultRollOverStrategy:
        max: "30"
        fileIndex: "max"

    # 파일 로그들
    File:
      - name: file-info-appender
        fileName: ${info-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-error-appender
        fileName: ${error-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-auth-appender
        fileName: ${auth-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
      - name: file-json-info-appender
        fileName: ${json-log}
        PatternLayout:
          pattern: ${file-layout-pattern}

  # [Loggers] 로그 출력 범위를 정의
  Loggers:
    # [Loggers - Root] 모든 로그를 기록하는 최상위 로그를 정의
    Root:
      level: OFF
      AppenderRef:
        - ref: console-appender
        - ref: rolling-file-appender

    # [Loggers - Loggers] 특정 패키지나 클래스에 대한 로그를 정의
    Logger:
      # 1. Spring Framework 로그
      - name: org.springframework
        additivity: "false"
        level: DEBUG
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender
          - ref: file-error-appender

      # 2. 애플리케이션 로그
      - name: site.icebang
        additivity: "false"
        level: TRACE
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender
          - ref: file-error-appender

      # 3. HikariCP 로그 비활성화
      - name: com.zaxxer.hikari
        level: OFF

      # 4. Spring Security 로그 - 인증/인가 추적에 중요
      - name: org.springframework.security
        level: DEBUG
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-auth-appender

      # 5. 웹 요청 로그 - 요청 처리 과정 추적
      - name: org.springframework.web
        level: DEBUG
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender

      # 6. 트랜잭션 로그 - DB 작업 추적
      - name: org.springframework.transaction
        level: DEBUG
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender

      - name: site.icebang.domain.auth.mapper
        level: DEBUG
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-info-appender