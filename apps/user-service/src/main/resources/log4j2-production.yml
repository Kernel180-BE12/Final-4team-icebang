Configuration:
  status: INFO
  name: production

  properties:
    property:
      - name: "app-name"
        value: "user-service"
      - name: "log-path"
        value: "./logs"
      - name: "charset-UTF-8"
        value: "UTF-8"
      # 프로덕션 환경용 콘솔 패턴 - 구조화된 로그
      - name: "console-layout-pattern"
        value: "%highlight{[%-5level]} [%X{traceId}] [%X{spanId}] %d{HH:mm:ss}{UTC} [%t]   %logger{20} - %msg% "
      # 파일용 패턴 - Promtail이 파싱하기 쉽게 구조화 (UTC 시간 사용)
      - name: "file-layout-pattern"
        value: "[%X{traceId}] [%X{spanId}] %d{yyyy-MM-dd HH:mm:ss.SSS}{UTC} [%t] %-5level %logger{36} - %msg%n"
      # 프로덕션 환경용 로그 파일들
      - name: "prod-log"
        value: ${log-path}/production/app.log
      - name: "error-log"
        value: ${log-path}/production/error.log

  Appenders:
    # 콘솔 출력 - 프로덕션에서는 최소한의 정보만
    Console:
      name: console-appender
      target: SYSTEM_OUT
      PatternLayout:
        pattern: ${console-layout-pattern}

    JDBC:
      name: workflow-appender
      tableName: "execution_log"
      bufferSize: 0
      ignoreExceptions: false

      DriverManager:
        connectionString: "jdbc:mariadb://${env:DB_HOST}:${env:DB_PORT}/${env:DB_NAME}"
        driverClassName: "org.mariadb.jdbc.Driver"
        userName: "${env:DB_USER}"
        password: "${env:DB_PASS}"

      ColumnMapping:
        - name: "execution_type"
          pattern: "%X{executionType}"
        - name: "source_id"
          pattern: "%X{sourceId}"
        - name: "log_level"
          pattern: "%level"
        - name: "executed_at"
          pattern: "%d{yyyy-MM-dd HH:mm:ss.SSS}"
        - name: "log_message"
          pattern: "%message"
        - name: "trace_id"
          pattern: "%X{traceId}"
        - name: "reserved1"
          pattern: "%X{spanId}"

    File:
      - name: file-prod-appender
        fileName: ${prod-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
        # 로그 파일 롤링 설정
        Policies:
          TimeBasedTriggeringPolicy:
            interval: 1
            modulate: true
          SizeBasedTriggeringPolicy:
            size: "100 MB"
        DefaultRolloverStrategy:
          max: 30
        filePattern: ${log-path}/production/app.%d{yyyy-MM-dd}.%i.log

      - name: file-error-appender
        fileName: ${error-log}
        PatternLayout:
          pattern: ${file-layout-pattern}
        ThresholdFilter:
          level: ERROR
        Policies:
          TimeBasedTriggeringPolicy:
            interval: 1
            modulate: true
          SizeBasedTriggeringPolicy:
            size: "100 MB"
        DefaultRolloverStrategy:
          max: 30
        filePattern: ${log-path}/production/error.%d{yyyy-MM-dd}.%i.log

  Loggers:
    # Root 로거 - 프로덕션에서는 WARN 레벨
    Root:
      level: WARN
      AppenderRef:
        - ref: console-appender

    Logger:
      # 애플리케이션 로그 - 프로덕션에서는 INFO 레벨
      - name: site.icebang
        additivity: "false"
        level: INFO
        AppenderRef:
          - ref: console-appender
          - ref: file-prod-appender
          - ref: file-error-appender

      - name: "WORKFLOW_HISTORY"
        level: INFO
        additivity: "false"
        AppenderRef:
          - ref: workflow-appender
          - ref: console-appender
          - ref: file-prod-appender
          - ref: file-error-appender

      # Spring Framework - 프로덕션에서는 WARN 레벨
      - name: org.springframework
        additivity: "false"
        level: WARN
        AppenderRef:
          - ref: console-appender
          - ref: file-prod-appender

      # Spring Security - 프로덕션에서는 WARN 레벨
      - name: org.springframework.security
        level: WARN
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-prod-appender

      # 웹 요청 로그 - 프로덕션에서는 INFO 레벨
      - name: org.springframework.web
        level: INFO
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-prod-appender

      # 트랜잭션 로그 - 프로덕션에서는 WARN 레벨
      - name: org.springframework.transaction
        level: WARN
        additivity: "false"
        AppenderRef:
          - ref: console-appender
          - ref: file-prod-appender

      # HikariCP 로그 비활성화
      - name: com.zaxxer.hikari
        level: "OFF"

      # SQL 로그 비활성화 - 프로덕션에서는 성능상 비활성화
      - name: org.hibernate.SQL
        level: "OFF"

      # 파라미터 바인딩 로그 비활성화
      - name: org.hibernate.type.descriptor.sql.BasicBinder
        level: "OFF"