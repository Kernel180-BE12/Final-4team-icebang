-- 테이블 DROP (재생성을 위해 기존 테이블을 삭제)
DROP TABLE IF EXISTS "ROLE_PERMISSION";
DROP TABLE IF EXISTS "USER_ROLE";
DROP TABLE IF EXISTS "PERMISSION";
DROP TABLE IF EXISTS "ROLE";
DROP TABLE IF EXISTS "USER_GROUP_INFO";
DROP TABLE IF EXISTS "GROUP_INFO";
DROP TABLE IF EXISTS "USER";


-- 사용자 정보 (외부 노출 가능성 높음 -> UUID)
CREATE TABLE "USER" (
                        "user_id" VARCHAR(36) NOT NULL,
                        "name" VARCHAR(100) NULL,
                        "email" VARCHAR(255) NULL UNIQUE,
                        "password" VARCHAR(255) NULL,
                        "phone_number" VARCHAR(50) NULL,
                        "fax_number" VARCHAR(50) NULL,
                        "zip_code" VARCHAR(20) NULL,
                        "main_address" VARCHAR(255) NULL,
                        "detail_address" VARCHAR(255) NULL,
                        "recommender_id" VARCHAR(36) NULL,
                        "resident_number" VARCHAR(100) NULL,
                        "corporate_number" VARCHAR(100) NULL,
                        "business_number" VARCHAR(100) NULL,
                        "type" VARCHAR(50) NULL,
                        "department" VARCHAR(100) NULL,
                        "job_title" VARCHAR(50) NULL,
                        "grade" VARCHAR(50) NULL,
                        "status" VARCHAR(50) NULL,
                        "joined_at" TIMESTAMP NULL,
                        "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                        "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                        PRIMARY KEY ("user_id")
);


CREATE TABLE "GROUP_INFO" (
                              "group_info_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                              "name" VARCHAR(255) NULL,
                              "description" TEXT NULL,
                              "status" VARCHAR(50) NULL,
                              "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                              "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "ROLE" (
                        "role_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                        "name" VARCHAR(50) NULL,
                        "code" VARCHAR(50) NULL UNIQUE,
                        "description" VARCHAR(255) NULL,
                        "status" VARCHAR(50) NULL,
                        "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                        "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "PERMISSION" (
                              "permission_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                              "name" VARCHAR(50) NULL,
                              "code" VARCHAR(50) NULL UNIQUE,
                              "resource" VARCHAR(50) NULL,
                              "action" VARCHAR(50) NULL,
                              "description" VARCHAR(255) NULL,
                              "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                              "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "USER_GROUP_INFO" (
                                   "user_group_info_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                   "user_id" VARCHAR(36) NOT NULL, -- USER 테이블 참조
                                   "group_info_id" BIGINT NOT NULL, -- GROUP_INFO 테이블 참조
                                   "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                                   "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                                   FOREIGN KEY ("user_id") REFERENCES "USER" ("user_id"),
                                   FOREIGN KEY ("group_info_id") REFERENCES "GROUP_INFO" ("group_info_id"),
                                   UNIQUE ("user_id", "group_info_id")
);

CREATE TABLE "USER_ROLE" (
                             "user_role_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                             "user_id" VARCHAR(36) NOT NULL, -- USER 테이블 참조
                             "role_id" BIGINT NOT NULL, -- ROLE 테이블 참조
                             "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                             "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                             FOREIGN KEY ("user_id") REFERENCES "USER" ("user_id"),
                             FOREIGN KEY ("role_id") REFERENCES "ROLE" ("role_id"),
                             UNIQUE ("user_id", "role_id")
);

CREATE TABLE "ROLE_PERMISSION" (
                                   "role_permission_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                   "role_id" BIGINT NOT NULL, -- ROLE 테이블 참조
                                   "permission_id" BIGINT NOT NULL, -- PERMISSION 테이블 참조
                                   "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                                   "updated_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                                   FOREIGN KEY ("role_id") REFERENCES "ROLE" ("role_id"),
                                   FOREIGN KEY ("permission_id") REFERENCES "PERMISSION" ("permission_id"),
                                   UNIQUE ("role_id", "permission_id")
);
